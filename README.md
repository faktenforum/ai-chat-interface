# AI Chat Interface

Modular Docker Compose setup for LibreChat, Open WebUI, and Firecrawl with Traefik as reverse proxy.

## Setup

### Local Development

1. **Environment Configuration**
   ```bash
   npm run setup
   ```
   This interactive script will configure:
   - Domain settings
   - Database credentials (MongoDB, PostgreSQL)
   - API keys (OpenRouter, Jina)
   - RabbitMQ credentials (for Firecrawl stability)
   - Registration settings (enabled by default for local development)
   - Email verification (enabled by default, uses MailDev for local testing)

### Production Deployment

1. **Production Environment Configuration**
   ```bash
   npm run setup:prod
   ```
   This generates `stack.env` with production-specific settings:
   - **Registration enabled** but restricted to allowed email domains (`@correctiv.org`, `@faktenforum.org`)
   - **SendGrid SMTP** for email verification
   - Production-optimized defaults from `env.prod.example`

## Usage

Select the stack you want to run:

### Modes

#### Standard (Official Images)
Uses official hub images.
```bash
docker compose up -d
```

#### Development (Local Builds)
Builds LibreChat and RAG components from local source.
```bash
docker compose -f docker-compose.dev.yml up -d
```

#### Production (Stable Release + SSL)
Enables Let's Encrypt SSL and security hardening.

First generate production environment variables:

```bash
npm run setup:prod
docker compose --env-file stack.env -f docker-compose.prod.yml up -d
```

### Deployment (Portainer)

1. **Generate Environment**: Generate production environment file:
   ```bash
   npm run setup:prod
   ```
   This creates `stack.env` with production-specific settings (no duplicates, production overrides applied).

2. **Deploy in Portainer CE**: 
   - Go to **Stacks** → **Add stack** → **Git Repository**
   - Repository URL: `https://github.com/Faktenforum/ai-chat-interface`
   - Reference: `refs/heads/traefik` (or your branch)
   - Compose path: `docker-compose.prod.yml`
   - Copy the contents of `stack.env` and paste into **Environment variables** section (Advanced mode)
   - **Important**: Config is generated by an init container (`config-init`) into a named volume
   - **Why**: Portainer CE creates empty directories for bind-mounted files, making them unreadable
   - **Solution**: `docker-compose.librechat.yml` writes a config file with `$${VAR}` placeholders; LibreChat resolves them at runtime from environment variables

### Compose file notes

- `docker-compose.yml`, `docker-compose.dev.yml`, and `docker-compose.prod.yml` are the supported entrypoints.
- The other `docker-compose.*.yml` files are reused via `extends` and are not intended to be run standalone.

## Administration

See [ADMINISTRATION.md](docs/ADMINISTRATION.md) for LibreChat administration tools and user management commands.

## Local Development Tools

### MailDev (Email Testing)
MailDev is automatically included in local development setups. It captures all outgoing emails for testing:
- **Web UI**: `http://maildev.localhost` (or `http://localhost:1080`)
- **SMTP**: `maildev:1025` (internal Docker network)
- Email verification is enabled by default (`LIBRECHAT_ALLOW_UNVERIFIED_EMAIL_LOGIN=false`)
- All emails sent by LibreChat can be viewed in the MailDev web interface

### Firecrawl Admin
`http://firecrawl.localhost/admin/<BULL_AUTH_KEY>/queues`
(Set `FIRECRAWL_BULL_AUTH_KEY` in `.env`)

## TODO

See [TODO.md](TODO.md) for the current list of tasks and improvements.

