# Production Environment - SSL, Security Headers, & High Availability
# Usage: docker compose -f docker-compose.prod.yml up -d

services:
  # --- LIBRECHAT ---
  mongodb:
    extends: { file: docker-compose.librechat.yml, service: mongodb }
    restart: always

  meilisearch:
    extends: { file: docker-compose.librechat.yml, service: meilisearch }
    restart: always

  api:
    extends: { file: docker-compose.librechat.yml, service: api }
    restart: always
    volumes:
      # Override to use production config with domain restrictions
      - type: bind
        source: ./config/librechat.prod.yaml
        target: /app/librechat.yaml
    labels:
      - "traefik.http.routers.librechat-secure.tls.certresolver=le"

  setup-permissions:
    extends: { file: docker-compose.librechat.yml, service: setup-permissions }

  # --- WEBUI ---
  # openwebui:
  #   extends: { file: docker-compose.openwebui.yml, service: openwebui }
  #   restart: always
  #   labels:
  #     - "traefik.http.routers.openwebui-secure.tls.certresolver=le"

  # --- WEBSEARCH ---
  searxng:
    extends: { file: docker-compose.websearch.yml, service: searxng }
    restart: always
    labels:
      - "traefik.http.routers.searxng-secure.tls.certresolver=le"

  firecrawl-api:
    extends: { file: docker-compose.websearch.yml, service: firecrawl-api }
    restart: always
    labels:
      - "traefik.http.routers.firecrawl-secure.tls.certresolver=le"

  playwright-service:
    extends: { file: docker-compose.websearch.yml, service: playwright-service }
    restart: always

  redis:
    extends: { file: docker-compose.websearch.yml, service: redis }
    restart: always

  nuq-postgres:
    extends: { file: docker-compose.websearch.yml, service: nuq-postgres }
    restart: always

  rabbitmq:
    extends: { file: docker-compose.websearch.yml, service: rabbitmq }
    restart: always

  # --- RAG ---
  vectordb:
    extends: { file: docker-compose.rag.yml, service: vectordb }
    restart: always

  rag_api:
    extends: { file: docker-compose.rag.yml, service: rag_api }
    restart: always

networks:
  traefik-net:
    external: true
    name: loadbalancer-net
  firecrawl-network:
    driver: bridge

volumes:
  firecrawl_pgdata:
  pgdata2:
