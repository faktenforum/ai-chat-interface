services:
  config-init:
    extends: { file: docker-compose.librechat.yml, service: config-init }
    networks:
      - app-net

  mongodb:
    extends: { file: docker-compose.librechat.yml, service: mongodb }
    restart: always
    volumes:
      - mongodata:/data/db
    networks:
      - app-net

  meilisearch:
    extends: { file: docker-compose.librechat.yml, service: meilisearch }
    restart: always
    networks:
      - app-net

  api:
    extends: { file: docker-compose.librechat.yml, service: api }
    restart: always
    networks:
      - traefik-net
      - app-net
    labels:
      - "traefik.http.routers.librechat-secure.tls.certresolver=le"

  setup-permissions:
    extends: { file: docker-compose.librechat.yml, service: setup-permissions }
    networks:
      - app-net

  searxng:
    extends: { file: docker-compose.websearch.yml, service: searxng }
    restart: always
    networks:
      - traefik-net
    labels:
      - "traefik.http.routers.searxng-secure.tls.certresolver=le"

  firecrawl-api:
    extends: { file: docker-compose.websearch.yml, service: firecrawl-api }
    restart: always
    networks:
      - traefik-net
      - firecrawl-network
    labels:
      - "traefik.http.routers.firecrawl-secure.tls.certresolver=le"

  playwright-service:
    extends: { file: docker-compose.websearch.yml, service: playwright-service }
    restart: always
    networks:
      - firecrawl-network

  redis:
    extends: { file: docker-compose.websearch.yml, service: redis }
    restart: always
    networks:
      - firecrawl-network

  nuq-postgres:
    extends: { file: docker-compose.websearch.yml, service: nuq-postgres }
    restart: always
    networks:
      - firecrawl-network

  rabbitmq:
    extends: { file: docker-compose.websearch.yml, service: rabbitmq }
    restart: always
    networks:
      - firecrawl-network

  vectordb:
    extends: { file: docker-compose.rag.yml, service: vectordb }
    restart: always
    networks:
      - app-net

  rag_api:
    extends: { file: docker-compose.rag.yml, service: rag_api }
    restart: always
    networks:
      - app-net

networks:
  traefik-net:
    external: true
    name: loadbalancer-net
  app-net:
    driver: bridge
  firecrawl-network:
    driver: bridge

volumes:
  mongodata:
  firecrawl_pgdata:
  pgdata2:
  librechat-config:
