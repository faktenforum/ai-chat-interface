# Standard Environment - Official Images (Local Development)
# Usage: docker compose up -d
services:
  # --- INFRASTRUCTURE ---
  traefik:
    extends: { file: docker-compose.traefik.yml, service: traefik }
    env_file: .env

  # --- INFRASTRUCTURE ---
  maildev:
    container_name: maildev
    image: maildev/maildev:latest
    restart: always
    ports:
      - "1080:1080"  # Web UI
      - "1025:1025"  # SMTP
    networks:
      - traefik-net
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.maildev.rule=Host(`maildev.${DOMAIN:-localhost}`)"
      - "traefik.http.routers.maildev.entrypoints=web"
      - "traefik.http.services.maildev.loadbalancer.server.port=1080"

  # --- LIBRECHAT ---
  config-init:
    extends: { file: docker-compose.librechat.yml, service: config-init }
    env_file: .env

  mongodb:
    extends: { file: docker-compose.librechat.yml, service: mongodb }
    env_file: .env
  
  meilisearch:
    extends: { file: docker-compose.librechat.yml, service: meilisearch }
    env_file: .env

  api:
    extends: { file: docker-compose.librechat.yml, service: api }
    env_file: .env

  setup-permissions:
    extends: { file: docker-compose.librechat.yml, service: setup-permissions }
    env_file: .env

  # --- WEBUI ---
  openwebui:
    extends: { file: docker-compose.openwebui.yml, service: openwebui }
    env_file: .env

  # --- WEBSEARCH ---
  searxng:
    extends: { file: docker-compose.websearch.yml, service: searxng }
    env_file: .env

  firecrawl-api:
    extends: { file: docker-compose.websearch.yml, service: firecrawl-api }
    env_file: .env

  playwright-service:
    extends: { file: docker-compose.websearch.yml, service: playwright-service }
    env_file: .env

  redis:
    extends: { file: docker-compose.websearch.yml, service: redis }
    env_file: .env

  nuq-postgres:
    extends: { file: docker-compose.websearch.yml, service: nuq-postgres }
    env_file: .env

  rabbitmq:
    extends: { file: docker-compose.websearch.yml, service: rabbitmq }
    env_file: .env

  # --- RAG ---
  vectordb:
    extends: { file: docker-compose.rag.yml, service: vectordb }
    env_file: .env

  rag_api:
    extends: { file: docker-compose.rag.yml, service: rag_api }
    env_file: .env

networks:
  traefik-net:
    driver: bridge
  firecrawl-network:
    driver: bridge

volumes:
  firecrawl_pgdata:
  pgdata2:
  librechat-config:
