# Grounded Docs MCP Server (docs-mcp-server) - fork submodule, image from registry
# Pattern 3: local stacks build from dev/docs-mcp-server; prod/Portainer use ghcr.io image
services:
  mcp-docs:
    image: ghcr.io/faktenforum/mcp-docs:latest
    container_name: mcp-docs
    restart: always
    command: ["--protocol", "http", "--host", "0.0.0.0", "--port", "6280"]
    environment:
      PORT: ${MCP_DOCS_PORT:-6280}
      DOCS_MCP_STORE_PATH: /data
      XDG_CONFIG_HOME: /config
      # Optional: semantic search. We use MCP_DOCS_* in .env; server expects DOCS_MCP_* / OPENAI_API_* (see docs/MCP_DOCS.md)
      OPENAI_API_KEY: ${MCP_DOCS_OPENAI_API_KEY:-}
      OPENAI_API_BASE: ${MCP_DOCS_OPENAI_API_BASE:-}
      DOCS_MCP_EMBEDDING_MODEL: ${MCP_DOCS_EMBEDDING_MODEL:-}
      DOCS_MCP_EMBEDDINGS_VECTOR_DIMENSION: ${MCP_DOCS_EMBEDDINGS_VECTOR_DIMENSION:-}
    volumes:
      - docs-mcp-data:/data
      - docs-mcp-config:/config
    expose:
      - "6280"
    networks:
      - app-net
    healthcheck:
      test: ["CMD-SHELL", "node -e \"require('net').connect(6280,'127.0.0.1').on('connect',()=>process.exit(0)).on('error',()=>process.exit(1))\""]
      interval: 45s
      timeout: 15s
      retries: 3
      start_period: 90s
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 1024M
        reservations:
          cpus: '0.5'
          memory: 256M
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
        compress: "true"

volumes:
  docs-mcp-data:
  docs-mcp-config:
