---
name: build-deploy-fork-images
description: Building and deploying Docker images from fork submodules (local build vs Portainer registry image)
---

# Building and Deploying Images from Fork Submodules

Use when a service runs from a **fork submodule** and we **build and publish** its image. Local stacks build from the submodule; Portainer/prod use the registry image.

**Related:** `@.cursor/rules/forked-submodules.mdc`, `@.cursor/rules/create-new-mcp.mdc` Pattern 3.

## When this applies

- Submodule in `dev/<name>/` (e.g. `dev/docs-mcp-server`, `dev/db-timetable-mcp`)
- CI builds and pushes to `ghcr.io/faktenforum/mcp-<name>`
- **Local / local-dev:** `build: context: ./dev/<name>`, same `image:` as prod (built locally)
- **Prod / dev:** Registry image only, **no** `build` section

## Compose layout

| File | Build | Image |
|------|--------|--------|
| Base `docker-compose.mcp-<name>.yml` | No | `ghcr.io/faktenforum/mcp-<name>:latest` |
| `docker-compose.local.yml` / `local-dev.yml` | Yes, `./dev/<name>` | Same (built locally) |
| `docker-compose.prod.yml` | No | `ghcr.io/faktenforum/mcp-<name>:latest` |
| `docker-compose.dev.yml` | No | `ghcr.io/faktenforum/mcp-<name>:dev` |

Base has no `build` so prod/dev only pull. Local override adds `build` and same `image:`.

## GitHub Actions

- **Path:** `.github/workflows/build-mcp-<name>.yml`
- **Trigger:** `push` paths `dev/<name>`, `dev/<name>/**`, workflow file; `workflow_dispatch`
- **Checkout:** `submodules: true`. **Context:** `./dev/<name>`. **Push:** `ghcr.io/faktenforum/mcp-<name>` tags `latest` (default branch), `dev`, branch name. **Platform:** `linux/amd64`; GHA cache.

Copy e.g. `build-mcp-docs.yml` or `build-mcp-db-timetable.yml` and adjust name/paths.

## Examples

`mcp-docs`, `mcp-db-timetable`, `mcp-stackoverflow`, `mcp-npm-search`, `mcp-openstreetmap`, `mcp-youtube-transcript`.
